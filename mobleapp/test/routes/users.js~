var express = require('express');
var router = express.Router();
var inspect = require('util').inspect;

var c = require('./db');
/* GET users listing. */
router.get('/', function(req, res) {
  var username = req.query['username'];
  var imsi = req.query['imsi'];
  res.send('respond with a resource,username= '+username +",imsi="+imsi);
});

//add by jack 20141126 for punch card

/*Add user*/
router.post('/',function(req,res){
  var username = req.body.username;
  var password = req.body.password;
  var realname = req.body.realname;
  var imsi = req.body.imsi;
  var dept = req.body.dept;
  var subCompany = req.body.subCompany;
  console.log('username='+username+",password=******,realname="+realname+",imsi="+imsi+",dept="+dept+",subCompany="+subCompany);

c.query('INSERT INTO USER (USERNAME,PASSWORD,REAL_NAME,CREATE_DATE,IMSI,DEPT,SUB_COMPANY) VALUES(:name,:password,:realname,CURRENT_DATE,:imsi,:dept,:subcompany)',
        { name: username,
	password:password,
	realname:realname,
	imsi:imsi,
	dept:dept,
	subcompany:subCompany })
 .on('result', function(res) {
   res.on('row', function(row) {
     console.log('Result row: ' + inspect(row));
   })
   .on('error', function(err) {
     console.log('Result error: ' + inspect(err));
   })
   .on('end', function(info) {
     console.log('Result finished successfully');
   });
 })
 .on('end', function() {
   console.log('Done with all results');
 });
  res.status(201);
  //res.set('Content-Type', 'application/json');
  res.json({username:username,password:password});
  //res.send('username='+username+",password="+password);
});

module.exports = router;
